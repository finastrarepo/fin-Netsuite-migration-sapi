<?xml version="1.0" encoding="UTF-8"?>

<mule
	xmlns:anypoint-mq="http://www.mulesoft.org/schema/mule/anypoint-mq"
	xmlns:wsc="http://www.mulesoft.org/schema/mule/wsc"
	xmlns:netsuite="http://www.mulesoft.org/schema/mule/netsuite"
	xmlns:http="http://www.mulesoft.org/schema/mule/http"
	xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core"
	xmlns="http://www.mulesoft.org/schema/mule/core"
	xmlns:doc="http://www.mulesoft.org/schema/mule/documentation"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd
http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd
http://www.mulesoft.org/schema/mule/netsuite http://www.mulesoft.org/schema/mule/netsuite/current/mule-netsuite.xsd
http://www.mulesoft.org/schema/mule/wsc http://www.mulesoft.org/schema/mule/wsc/current/mule-wsc.xsd
http://www.mulesoft.org/schema/mule/anypoint-mq http://www.mulesoft.org/schema/mule/anypoint-mq/current/mule-anypoint-mq.xsd">
	<sub-flow name="netsuite-integration-projectSetup-flowSub_Flow" doc:id="91c4ee31-1017-48f0-954f-bca7e63dc1e0" >
		<logger level="INFO" doc:name="Logger" doc:id="84b24689-f8ec-429b-8cb2-bbfa2c8db6a9" message='#[{requestFor:"ProjectSetUp"} ++ payload]'/>
		<choice doc:name="Choice" doc:id="90b9eeb5-13d0-404d-90e6-4b6c4bf9f1ab" >
			<when expression="#[(!(isEmpty(payload.job)))]">
				<flow-ref doc:name="Job-Implementation" doc:id="5f5b0d32-754c-4175-accb-580c4c8b9e3e" name="Job-Implementation"/>
			</when>
			<otherwise >
				<logger level="INFO" doc:name="Logger" doc:id="4f27c062-4c8f-44a9-8fad-ba66c7ab08de" message="Project task "/>
				<flow-ref doc:name="ProjectTask-Implementation" doc:id="22d19668-24b6-4f32-8902-da57a22a0b83" name="vendorBilling-Implementation"/>
			</otherwise>
		</choice>
	</sub-flow>
	
	<!--  
	<sub-flow name="netsuite-integration-invoice-salesOrderDetails" doc:id="ad4cbca9-4c18-4c40-ad54-45529c3dcc34" >
		<ee:transform doc:name="restUrl-formation" doc:id="ac2b4097-45c6-4a0c-83df-205708d0ed98" >
			<ee:message >
			</ee:message>
			<ee:variables >
				<ee:set-variable variableName="restUrl" ><![CDATA[%dw 2.0
output application/json
var host = p('kimbleRestNetsuite.urlHost') 
var path = p('kimbleRestNetsuite.urlPathSalesOrder')
var id = vars.invoicePayload.salesOrderId[0]
-&#45;&#45;
{
url : "https://" ++ host ++ path ++ id,
method : p('http.methodGet')  


}]]></ee:set-variable>
			</ee:variables>
		</ee:transform>
		<try doc:name="Try" doc:id="312d3292-53ec-4da6-a4b2-e5d63f90aca7" >
			<flow-ref doc:name="oauth-header-generator-restKimble" doc:id="fa5080a5-708f-4ece-8ff1-3a65cfbe8711" name="oauth-header-generator-restKimble" />
			<http:request method="GET" doc:name="Get SalesOrder Details" doc:id="d3cf80da-5c13-4909-89db-aa8c88e66d62" config-ref="HTTP_Request_configuration" responseTimeout="${httpRequest.responseTimeout}" url="#[vars.restUrl.url]" target="responsePayloadSalesOrder">
			<ee:repeatable-file-store-stream bufferUnit="MB" />
			<http:headers><![CDATA[#[%dw 2.0
output application/java
-&#45;&#45;

 


{"Authorization": vars.oAuthHeaderFinal,
    "Content-Type":"application/json"
    
}]]]></http:headers>
        </http:request>
			<error-handler >
				<on-error-continue enableNotifications="true" logException="true" doc:name="On Error Continue" doc:id="e9c62c8d-a4bd-4fc0-b423-3f787ffb9850" type="ANY">
					<logger level="INFO" doc:name="No salesOrder details" doc:id="5cf17d26-eaca-486a-9a55-55c8cd52b422" message="#[error.detailedDescription]"/>
				</on-error-continue>
			</error-handler>
		</try>
		<ee:transform doc:name="salesOrderDetails" doc:id="e2d4d200-246e-41d1-a1d5-c2c65c9947fe" >
			<ee:message >
			</ee:message>
			<ee:variables >
				<ee:set-variable variableName="salesOrderDetails" ><![CDATA[%dw 2.0
output application/json
var res = vars.responsePayloadSalesOrder
-&#45;&#45;
{
    
    "poReference" : res.otherRefNum default vars.invoicePayload.poReference[0]
}

]]></ee:set-variable>
			</ee:variables>
		</ee:transform>
	</sub-flow>   -->
</mule>

